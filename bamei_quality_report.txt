================================================================================
NL_SE テーブル Bamei（馬名）品質検査レポート
================================================================================

総レコード数: 77,624

================================================================================
最新10件のBamei（馬名）詳細解析
================================================================================

--- レコード 1 ---
バイト長: 15 bytes
Hex: 3f 78 3f 72 e3 83 bc 3f 59 3f 75 3f 3f 3f 58
? マーク (0x3f) の数: 7

デコード結果:
  cp932       : ?x?r繝ｼ?Y?u???X
  shift_jis   : ?x?r繝ｼ?Y?u???X
  utf-8       : ?x?rー?Y?u???X

** 判定: 文字化けあり（? が30%以上）**

--- レコード 2 ---
バイト長: 21 bytes
Hex: 3f 6e 3f 3f 3f 45 3f 62 3f 68 3f ef bf bd 3f 3f 3f 3f e3 83 bc
? マーク (0x3f) の数: 11

デコード結果:
  cp932       : ?n???E?b?h?ｿｽ????繝ｼ
  shift_jis   : ?n???E?b?h?ｿｽ????繝ｼ
  utf-8       : ?n???E?b?h?�????ー

** 判定: 文字化けあり（? が30%以上）**

--- レコード 3 ---
バイト長: 18 bytes
Hex: 3f 57 3f 3f 3f 3f 3f 3f 3f 40 3f 3f 3f 50 3f 62 3f 67
? マーク (0x3f) の数: 13

デコード結果:
  cp932       : ?W???????@???P?b?g
  shift_jis   : ?W???????@???P?b?g
  utf-8       : ?W???????@???P?b?g

** 判定: 文字化けあり（? が30%以上）**

--- レコード 4 ---
バイト長: 21 bytes
Hex: 3f 71 e3 83 bc 3f e9 a6 99 5b 3f 43 3f 3f 3f 60 e3 83 bc 3f 74
? マーク (0x3f) の数: 7

デコード結果:
  cp932       : ?q繝ｼ?鬥兌?C???`繝ｼ?t
  shift_jis   : ?q繝ｼ?鬥兌?C???`繝ｼ?t
  utf-8       : ?qー?香[?C???`ー?t

** 判定: 文字化けあり（? が30%以上）**

--- レコード 5 ---
バイト長: 16 bytes
Hex: 3f 41 3f 3f e3 83 bc 3f 3f 3f 3f e3 83 bc 3f 78
? マーク (0x3f) の数: 8

デコード結果:
  cp932       : ?A??繝ｼ????繝ｼ?x
  shift_jis   : ?A??繝ｼ????繝ｼ?x
  utf-8       : ?A??ー????ー?x

** 判定: 文字化けあり（? が30%以上）**

--- レコード 6 ---
バイト長: 16 bytes
Hex: 3f 5c 3f 3f 3f 4f 3f 49 3f 75 3f 3f 3f 43 3f 74
? マーク (0x3f) の数: 10

デコード結果:
  cp932       : ?\???O?I?u???C?t
  shift_jis   : ?\???O?I?u???C?t
  utf-8       : ?\???O?I?u???C?t

** 判定: 文字化けあり（? が30%以上）**

--- レコード 7 ---
バイト長: 20 bytes
Hex: 3f 75 3f 3f e3 83 bc 3f 41 3f 43 3f 68 3f 4b e3 83 bc 3f 3f
? マーク (0x3f) の数: 9

デコード結果:
  cp932       : ?u??繝ｼ?A?C?h?K繝ｼ??
  shift_jis   : ?u??繝ｼ?A?C?h?K繝ｼ??
  utf-8       : ?u??ー?A?C?h?Kー??

** 判定: 文字化けあり（? が30%以上）**

--- レコード 8 ---
バイト長: 18 bytes
Hex: 3f 75 3f 3f 3f 43 3f 65 3f 42 3f 41 3f 5f 3f 43 3f 3f
? マーク (0x3f) の数: 11

デコード結果:
  cp932       : ?u???C?e?B?A?_?C??
  shift_jis   : ?u???C?e?B?A?_?C??
  utf-8       : ?u???C?e?B?A?_?C??

** 判定: 文字化けあり（? が30%以上）**

--- レコード 9 ---
バイト長: 17 bytes
Hex: 3f 73 e3 83 bc 3f 58 3f 74 3f 3f 3f 69 3f 43 3f 67
? マーク (0x3f) の数: 8

デコード結果:
  cp932       : ?s繝ｼ?X?t???i?C?g
  shift_jis   : ?s繝ｼ?X?t???i?C?g
  utf-8       : ?sー?X?t???i?C?g

** 判定: 文字化けあり（? が30%以上）**

--- レコード 10 ---
バイト長: 19 bytes
Hex: 3f 57 3f 49 3f 70 e3 83 bc 3f 4e 3f 4e 3f 3f 3f 45 3f 3f
? マーク (0x3f) の数: 10

デコード結果:
  cp932       : ?W?I?p繝ｼ?N?N???E??
  shift_jis   : ?W?I?p繝ｼ?N?N???E??
  utf-8       : ?W?I?pー?N?N???E??

** 判定: 文字化けあり（? が30%以上）**

================================================================================
検査サマリー
================================================================================

検査件数: 10
文字化け検出: 10 件 (100.0%)
正常: 0 件

================================================================================
問題の原因
================================================================================

データベースに保存されているBamei（馬名）データに大量の ? (0x3f) が含まれています。

原因:
  1. JV-Link COM から pywin32 が Shift-JIS データを受信
  2. src/jvlink/wrapper.py の jv_read() メソッド（406行目）で
     buff_str.encode("latin-1", errors="replace") を実行
  3. latin-1 で表現できない文字が ? (0x3f) に置換される
  4. パーサーが破損したバイトデータを受け取る
  5. データベースに文字化けしたデータが保存される

影響:
  - 馬名が正しく表示されない
  - 日本語テキストの大部分が ? に置換されている
  - データの検索・分析が不可能

修正方法:
  1. src/jvlink/wrapper.py の 406行目の errors="replace" を
     errors="strict" に変更し、エラーを明示的に検出
  2. pywin32 から受け取る文字列の内容を詳細にログ出力して
     U+0000-U+00FF 範囲外の文字が実際に含まれるか確認
  3. 必要に応じて適切なエンコーディング処理を実装
  4. データベースを削除して再インポート
